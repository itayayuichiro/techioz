<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <link rel="icon" href="../favicon.ico" />
  <link rel="stylesheet" href="../style.css">
  <title>テスト環境でRubyOnRailsの起動に失敗しました | Techioz</title>
  <style type="text/css">code{white-space: pre;}</style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1637770322917058"
     crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DRM1ZRNLDN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-DRM1ZRNLDN');
  </script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "headline": "テスト環境でRubyOnRailsの起動に失敗しました",
  "author": {
    "@type": "Person",
    "address": "",
    "email": null,
    "identifier": "masyumaroking",
    "name": "masyumaroking"
  },
  "publisher": {
    "@type": "Person",
    "name": "masyumaroking"
  }
}
</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
  <header>
    <div class="container">
        <h1>Techioz Blog</h1>
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Articles</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </nav>
    </div>
  </header>
  <main>
    <div class="container">
        <article>
                      <h2>テスト環境でRubyOnRailsの起動に失敗しました</h2>
                    <h2 id="概要">概要</h2>
                    <pre><code>RAILS_ENV=development rails c
</code></pre>
                    <p>仕事です、</p>
                    <p>しかし</p>
                    <pre><code>RAILS_ENV=test rails c
</code></pre>
                    <p>このエラーが発生しました</p>
                    <pre><code># RAILS_ENV=test rails c
/home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/railties-7.0.8/lib/rails.rb:47:in `configuration&#39;: undefined method `config&#39; for nil:NilClass (NoMethodError)

      application.config
                 ^^^^^^^
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/factory_bot_rails-6.4.0/lib/factory_bot_rails/railtie.rb:25:in `block in &lt;class:Railtie&gt;&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activesupport-7.0.8/lib/active_support/lazy_load_hooks.rb:95:in `class_eval&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activesupport-7.0.8/lib/active_support/lazy_load_hooks.rb:95:in `block in execute_hook&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activesupport-7.0.8/lib/active_support/lazy_load_hooks.rb:85:in `with_execution_control&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activesupport-7.0.8/lib/active_support/lazy_load_hooks.rb:90:in `execute_hook&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activesupport-7.0.8/lib/active_support/lazy_load_hooks.rb:60:in `block in on_load&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activesupport-7.0.8/lib/active_support/lazy_load_hooks.rb:59:in `each&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/activesupport-7.0.8/lib/active_support/lazy_load_hooks.rb:59:in `on_load&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/factory_bot_rails-6.4.0/lib/factory_bot_rails/railtie.rb:24:in `&lt;class:Railtie&gt;&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/factory_bot_rails-6.4.0/lib/factory_bot_rails/railtie.rb:10:in `&lt;module:FactoryBotRails&gt;&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/factory_bot_rails-6.4.0/lib/factory_bot_rails/railtie.rb:9:in `&lt;main&gt;&#39;
        from &lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
        from &lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bootsnap-1.17.0/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:32:in `require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/factory_bot_rails-6.4.0/lib/factory_bot_rails.rb:1:in `&lt;main&gt;&#39;
        from &lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
        from &lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bootsnap-1.17.0/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:32:in `require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bundler-2.4.18/lib/bundler/runtime.rb:60:in `block (2 levels) in require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bundler-2.4.18/lib/bundler/runtime.rb:55:in `each&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bundler-2.4.18/lib/bundler/runtime.rb:55:in `block in require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bundler-2.4.18/lib/bundler/runtime.rb:44:in `each&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bundler-2.4.18/lib/bundler/runtime.rb:44:in `require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bundler-2.4.18/lib/bundler.rb:187:in `require&#39;
        from /home/seluser/app/config/application.rb:19:in `&lt;main&gt;&#39;
        from &lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
        from &lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bootsnap-1.17.0/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:32:in `require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/railties-7.0.8/lib/rails/command/actions.rb:22:in `require_application!&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/railties-7.0.8/lib/rails/command/actions.rb:14:in `require_application_and_environment!&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/railties-7.0.8/lib/rails/commands/console/console_command.rb:105:in `perform&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/thor-1.3.0/lib/thor/command.rb:28:in `run&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/thor-1.3.0/lib/thor/invocation.rb:127:in `invoke_command&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/thor-1.3.0/lib/thor.rb:527:in `dispatch&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/railties-7.0.8/lib/rails/command/base.rb:87:in `perform&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/railties-7.0.8/lib/rails/command.rb:48:in `invoke&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/railties-7.0.8/lib/rails/commands.rb:18:in `&lt;main&gt;&#39;
        from &lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
        from &lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
        from /home/seluser/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/bootsnap-1.17.0/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:32:in `require&#39;
        from bin/rails:4:in `&lt;main&gt;&#39;
</code></pre>
                    <p>私を助けてください。</p>
                    <pre><code>rails 7.0.8
ruby 3.2.2
</code></pre>
                    <pre><code>require &quot;active_support/core_ext/integer/time&quot;

Rails.application.configure do
  # Settings specified here will take precedence over those in config/application.rb.

  # In the development environment your application&#39;s code is reloaded any time
  # it changes. This slows down response time but is perfect for development
  # since you don&#39;t have to restart the web server when you make code changes.
  config.cache_classes = false

  # Do not eager load code on boot.
  config.eager_load = false

  # Show full error reports.
  config.consider_all_requests_local = true

  # Enable server timing
  config.server_timing = true

  # Enable/disable caching. By default caching is disabled.
  # Run rails dev:cache to toggle caching.
  if Rails.root.join(&quot;tmp/caching-dev.txt&quot;).exist?
    config.action_controller.perform_caching = true
    config.action_controller.enable_fragment_cache_logging = true

    config.cache_store = :memory_store
    config.public_file_server.headers = {
      &quot;Cache-Control&quot; =&gt; &quot;public, max-age=#{2.days.to_i}&quot;
    }
  else
    config.action_controller.perform_caching = false

    config.cache_store = :null_store
  end

  # Store uploaded files on the local file system (see config/storage.yml for options).
  config.active_storage.service = :local

  # Don&#39;t care if the mailer can&#39;t send.
  config.action_mailer.raise_delivery_errors = false

  config.action_mailer.perform_caching = false

  config.action_mailer.delivery_method = :letter_opener_web

  # Print deprecation notices to the Rails logger.
  config.active_support.deprecation = :log

  # Raise exceptions for disallowed deprecations.
  config.active_support.disallowed_deprecation = :raise

  # Tell Active Support which deprecation messages to disallow.
  config.active_support.disallowed_deprecation_warnings = []

  # Raise an error on page load if there are pending migrations.
  config.active_record.migration_error = :page_load

  # Highlight code that triggered database queries in logs.
  config.active_record.verbose_query_logs = true

  # Suppress logger output for asset requests.
  config.assets.quiet = true

  # Raises error for missing translations.
  # config.i18n.raise_on_missing_translations = true

  # Annotate rendered view with file names.
  # config.action_view.annotate_rendered_view_with_filenames = true

  # Uncomment if you wish to allow Action Cable access from any origin.
  # config.action_cable.disable_request_forgery_protection = true

  LetterOpenerWeb.configure do |config|
    config.letters_location = Rails.root.join(&#39;log/letter_opener&#39;)
  end
end
</code></pre>
                    <pre><code>require &quot;active_support/core_ext/integer/time&quot;

# The test environment is used exclusively to run your application&#39;s
# test suite. You never need to work with it otherwise. Remember that
# your test database is &quot;scratch space&quot; for the test suite and is wiped
# and recreated between test runs. Don&#39;t rely on the data there!

Rails.application.configure do
  # Settings specified here will take precedence over those in config/application.rb.

  # Turn false under Spring and add config.action_view.cache_template_loading = true.
  config.cache_classes = true

  # Eager loading loads your whole application. When running a single test locally,
  # this probably isn&#39;t necessary. It&#39;s a good idea to do in a continuous integration
  # system, or in some way before deploying your code.
  config.eager_load = ENV[&quot;CI&quot;].present?

  # Configure public file server for tests with Cache-Control for performance.
  config.public_file_server.enabled = true
  config.public_file_server.headers = {
    &quot;Cache-Control&quot; =&gt; &quot;public, max-age=#{1.hour.to_i}&quot;
  }

  # Show full error reports and disable caching.
  config.consider_all_requests_local       = true
  config.action_controller.perform_caching = false
  config.cache_store = :null_store

  # Raise exceptions instead of rendering exception templates.
  config.action_dispatch.show_exceptions = false

  # Disable request forgery protection in test environment.
  config.action_controller.allow_forgery_protection = false

  # Store uploaded files on the local file system in a temporary directory.
  config.active_storage.service = :test

  config.action_mailer.perform_caching = false

  # Tell Action Mailer not to deliver emails to the real world.
  # The :test delivery method accumulates sent emails in the
  # ActionMailer::Base.deliveries array.
  config.action_mailer.delivery_method = :test

  # Print deprecation notices to the stderr.
  config.active_support.deprecation = :stderr

  # Raise exceptions for disallowed deprecations.
  config.active_support.disallowed_deprecation = :raise

  # Tell Active Support which deprecation messages to disallow.
  config.active_support.disallowed_deprecation_warnings = []

  # Raises error for missing translations.
  # config.i18n.raise_on_missing_translations = true

  # Annotate rendered view with file names.
  # config.action_view.annotate_rendered_view_with_filenames = true
end
</code></pre>
                    <pre><code>require_relative &#39;boot&#39;

require &quot;rails&quot;
# Pick the frameworks you want:
require &quot;active_model/railtie&quot;
require &quot;active_job/railtie&quot;
require &quot;active_record/railtie&quot;
require &quot;active_storage/engine&quot;
require &quot;action_controller/railtie&quot;
require &quot;action_mailer/railtie&quot;
require &quot;action_mailbox/engine&quot;
require &quot;action_text/engine&quot;
require &quot;action_view/railtie&quot;
# require &quot;action_cable/engine&quot;
require &quot;rails/test_unit/railtie&quot;

# Require the gems listed in Gemfile, including any gems
# you&#39;ve limited to :test, :development, or :production.
Bundler.require(*Rails.groups)

module App
  class Application &lt; Rails::Application
    # Initialize configuration defaults for originally generated Rails version.
    config.load_defaults 7.0

    # Don&#39;t generate system test files.
    config.generators.system_tests = nil

    # config.i18n.default_locale = :ja

    config.time_zone = &#39;Asia/Tokyo&#39;

    # 本番環境でもauto_loadを有効にする
    config.enable_dependency_loading = true

    # デザイン崩れるので、自動で読み込まれるfield_with_errorsタグを読み込まないように設定する。まさにこの記事。@see https://qiita.com/uminchu-1173/items/bb1ffab51aa9eb9d98fd
    config.action_view.field_error_proc = Proc.new { |html_tag, instance| html_tag }


    config.autoload_paths += %W(#{config.root}/lib)
    config.autoload_paths += %W(#{Rails.root}/app/search_form)
    config.autoload_paths += %W(#{Rails.root}/app/batches)
    config.autoload_paths += %W(#{Rails.root}/app/services)
    config.autoload_paths += %W(#{Rails.root}/app/errors)

    config.autoload_paths += %W(#{Rails.root}/errors)
  end
end
</code></pre>
                    <p>以下も試してみました。</p>
                    <pre><code>cp config/environments/development.rb config/environments/test.rb
RAILS_ENV=test rails c
</code></pre>
                    <p>しかしエラーは変わりませんでした。</p>
                    <pre><code># RAILS_ENV=test rails db:migrate
rails aborted!
NoMethodError: undefined method `config&#39; for nil:NilClass (NoMethodError)

      application.config
                 ^^^^^^^
&lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
&lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
&lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
&lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
/home/seluser/app/config/application.rb:19:in `&lt;main&gt;&#39;
/home/seluser/app/rakefile:4:in `require_relative&#39;
/home/seluser/app/rakefile:4:in `&lt;main&gt;&#39;
&lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
&lt;internal:/home/seluser/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require&#39;
bin/rails:4:in `&lt;main&gt;&#39;
</code></pre>
                    <h2 id="解決策">解決策</h2>
                    <p>Factory_bot_rails を v6.4.2
                    にアップグレードする必要があります</p>
                    <p>https://translate.google.com/translate?hl=ja&amp;sl=en&amp;tl=ja&amp;u=https://github.com/thoughtbot/factory_bot_rails/pull/440</p>
                    <p>また、app/ の下のディレクトリが自動ロード
                    パスに自動的に追加されることにも注意してください。
                    ActiveSupport::Dependency.autoload_paths</p>
                    <p>したがって、これを行う必要はありません。
                    config.autoload_paths +=
                    %W(#{Rails.root}/app/search_form)。</p>
        </article>
    </div>
  </main>
  <footer>
    <div class="container">
        <p>&copy; 2024 Techioz. All rights reserved.</p>
    </div>
  </footer>
</body>
</html>