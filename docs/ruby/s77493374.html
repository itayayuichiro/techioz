<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <link rel="icon" href="../favicon.ico" />
  <link rel="stylesheet" href="../style.css">
  <title>React-native 0.72.6 へのアップグレード後の Podfile エラー | Techioz</title>
  <style type="text/css">code{white-space: pre;}</style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1637770322917058"
     crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DRM1ZRNLDN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-DRM1ZRNLDN');
  </script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "headline": "React-native 0.72.6 へのアップグレード後の Podfile エラー",
  "author": {
    "@type": "Person",
    "address": "",
    "email": null,
    "identifier": "masyumaroking",
    "name": "masyumaroking"
  },
  "publisher": {
    "@type": "Person",
    "name": "masyumaroking"
  }
}
</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
  <header>
    <div class="container">
        <h1>Techioz Blog</h1>
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Articles</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </nav>
    </div>
  </header>
  <main>
    <div class="container">
        <article>
                      <h2>React-native 0.72.6 へのアップグレード後の
Podfile エラー</h2>
                    <h2 id="概要">概要</h2>
                    <p>React Native を 0.69.6 から 0.72.6
                    にアップグレードしようとしています。</p>
                    <p>アップグレードヘルパーツールを使用しています:
                    https://react-native-community.github.io/upgrade-helper/?from=0.69.6&amp;to=0.72.6</p>
                    <p>pod install の実行時に Podfile
                    に変更を追加すると、次のようになります。</p>
                    <pre><code>
undefined local variable or method `config&#39; for #&lt;Pod::Podfile:0x00007fd4af859360&gt;

&lt;projectPath&gt;/ios/Podfile:109:in `block (2 levels) in from_ruby&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-core-1.11.3/lib/cocoapods-core/podfile.rb:196:in `post_install!&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer.rb:945:in `run_podfile_post_install_hook&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer.rb:933:in `block in run_podfile_post_install_hooks&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/user_interface.rb:149:in `message&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer.rb:932:in `run_podfile_post_install_hooks&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer.rb:331:in `block (2 levels) in create_and_save_projects&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer/xcode/pods_project_generator/pods_project_writer.rb:61:in `write!&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer.rb:330:in `block in create_and_save_projects&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/user_interface.rb:64:in `section&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer.rb:309:in `create_and_save_projects&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer.rb:301:in `generate_pods_project&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer.rb:180:in `integrate&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/installer.rb:167:in `install!&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/command/install.rb:52:in `run&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/claide-1.1.0/lib/claide/command.rb:334:in `run&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/lib/cocoapods/command.rb:52:in `run&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/cocoapods-1.11.3/bin/pod:55:in `&lt;top (required)&gt;&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/bin/pod:23:in `load&#39;
&lt;userPath&gt;/.rbenv/versions/2.7.5/bin/pod:23:in `&lt;main&gt;&#39;
</code></pre>
                    <p>私の Podfile は次のようになります。</p>
                    <pre><code># Resolve react_native_pods.rb with node to allow for hoisting
require Pod::Executable.execute_command(&#39;node&#39;, [&#39;-p&#39;,
  &#39;require.resolve(
    &quot;react-native/scripts/react_native_pods.rb&quot;,
    {paths: [process.argv[1]]},
  )&#39;, __dir__]).strip
platform :ios, min_ios_version_supported
prepare_react_native_project!

flipper_config = ENV[&#39;NO_FLIPPER&#39;] == &quot;1&quot; ? FlipperConfiguration.disabled : FlipperConfiguration.enabled
linkage = ENV[&#39;USE_FRAMEWORKS&#39;]
if linkage != nil
  Pod::UI.puts &quot;Configuring Pod with #{linkage}ally linked Frameworks&quot;.green
  use_frameworks! :linkage =&gt; linkage.to_sym
end

install! &#39;cocoapods&#39;, :deterministic_uuids =&gt; false
use_frameworks! :linkage =&gt; :static
inhibit_all_warnings!

# Turn off the ad id support for firebase analytics because the app is meant to
# be used by kids. See related error below as to why we need this:
# FastlaneCore::Interface::FastlaneShellError: [!] RNFBAnalytics: Using default
# Firebase/Analytics with Ad Ids. May require App Tracking Transparency.
# Not allowed for Kids apps.
$RNFirebaseAnalyticsWithoutAdIdSupport = true

source &#39;https://cdn.cocoapods.org/&#39;

target &#39;WonderPushNotificationServiceExtension&#39; do
  platform :ios, &#39;10.0&#39;

  # Pods for WonderPushNotificationServiceExtension
  pod &#39;WonderPushExtension&#39;, &#39;~&gt; 4.0&#39;
end

# Avoid duplicate symbols:
$dynamic_library = [&#39;StreamAMGSDK/PlayKit&#39;, &#39;YouboraLib&#39;]
pre_install do |installer|
  Pod::Installer::Xcode::TargetValidator.send(:define_method, :verify_no_static_framework_transitive_dependencies) {}
  installer.pod_targets.each do |pod|
    bt = pod.send(:build_type)
    if $dynamic_library.include?(pod.name)
      puts &quot;** #{pod.name} left as dynamic **&quot;
    else
      puts &quot;#{pod.name} static_library&quot;
      def pod.build_type;
      Pod::BuildType.static_library
    end
  end
end
end


target &#39;MyProjectName&#39; do
 # Flags change depending on the env values.
  flags = get_default_flags()
  permissions_path = &#39;../node_modules/react-native-permissions/ios&#39;
  config = use_native_modules!
  use_react_native!(
    :path =&gt; config[:reactNativePath],
    :hermes_enabled =&gt; true,
    :fabric_enabled =&gt; flags[:fabric_enabled],
    #  :flipper_configuration =&gt; FlipperConfiguration.enabled,
    # An absolute path to your application root.
    :app_path =&gt; &quot;#{Pod::Config.instance.installation_root}/..&quot;
  )

  pod &#39;SwiftLint&#39;
  pod &#39;GoogleAds-IMA-iOS-SDK&#39;, &#39;~&gt; 3.18.1&#39;
  pod &#39;StreamAMGSDK/PlayKit&#39;, &#39;1.3.0&#39;
  pod &#39;XCGLogger&#39;, :modular_headers =&gt; true
  pod &#39;ObjcExceptionBridging&#39;, :modular_headers =&gt; true
  pod &#39;react-native-google-cast/NoBluetooth&#39;, path: &#39;../node_modules/react-native-google-cast/&#39;
  pod &#39;google-cast-sdk-no-bluetooth&#39;
  pod &#39;DailymotionPlayerSDK&#39;, &#39;4.0.4&#39;

  pod &#39;Permission-AppTrackingTransparency&#39;, :path =&gt; &quot;#{permissions_path}/AppTrackingTransparency&quot;
  pod &#39;Permission-Notifications&#39;, :path =&gt; &quot;#{permissions_path}/Notifications&quot;

  pod &#39;Firebase&#39;, &#39;~&gt; 10.17.0&#39;, :modular_headers =&gt; true
  pod &#39;FirebaseCore&#39;, &#39;~&gt; 10.17.0&#39;, :modular_headers =&gt; true
  pod &#39;FirebaseCoreInternal&#39;, &#39;~&gt; 10.17.0&#39;, :modular_headers =&gt; true
  pod &#39;FirebaseCoreExtension&#39;, &#39;~&gt; 10.17.0&#39;, :modular_headers =&gt; true
  pod &#39;FirebaseInstallations&#39;, &#39;~&gt; 10.17.0&#39;, :modular_headers =&gt; true
  pod &#39;Firebase/Performance&#39;, &#39;~&gt; 10.17.0&#39;, :modular_headers =&gt; true
  pod &#39;Firebase/Crashlytics&#39;, &#39;~&gt; 10.17.0&#39;, :modular_headers =&gt; true
  pod &#39;Firebase/DynamicLinks&#39;, &#39;~&gt; 10.17.0&#39;, :modular_headers =&gt; true
  pod &#39;FirebaseABTesting&#39;, :modular_headers =&gt; true
  pod &#39;FirebaseRemoteConfig&#39;, :modular_headers =&gt; true
  pod &#39;GoogleDataTransport&#39;, :modular_headers =&gt; true
  pod &#39;nanopb&#39;, :modular_headers =&gt; true
  pod &#39;GoogleUtilities&#39;, :modular_headers =&gt; true

end

post_install do |installer|
  # config = use_native_modules! &lt;---- re-adding this fixes the issue but is it OK??
  flipper_post_install(installer)

 # https://github.com/facebook/react-native/blob/main/packages/react-native/scripts/react_native_pods.rb#L197-L202
    react_native_post_install(
      installer,
      config[:reactNativePath],
      :mac_catalyst_enabled =&gt; false
    )
  __apply_Xcode_12_5_M1_post_install_workaround(installer)

  # older fixes, not sure if they are still needed in RN 0.72.6:

  installer.pods_project.build_configurations.each do |config|
    config.build_settings[&quot;EXCLUDED_ARCHS[sdk=iphonesimulator*]&quot;] = &quot;arm64&quot;
  end

  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings[&#39;IPHONEOS_DEPLOYMENT_TARGET&#39;] = &#39;15.0&#39;
    end
  end

  installer.pods_project.targets.each do |target|
            target.build_configurations.each do |config|
              config.build_settings[&#39;GCC_PREPROCESSOR_DEFINITIONS&#39;] ||= [&#39;$(inherited)&#39;, &#39;_LIBCPP_ENABLE_CXX17_REMOVED_UNARY_BINARY_FUNCTION&#39;]
            end
          end

  # https://github.com/CocoaPods/CocoaPods/issues/11402#issuecomment-1201464693
  installer.pods_project.targets.each do |target|
    if target.respond_to?(:product_type) and target.product_type == &quot;com.apple.product-type.bundle&quot;
      target.build_configurations.each do |config|
          config.build_settings[&#39;CODE_SIGNING_ALLOWED&#39;] = &#39;NO&#39;
      end
    end
  end
end
</code></pre>
                    <p>ここでこの答えを見つけましたが、それをPodfileコンテンツに適応させる方法がわかりません。</p>
                    <p>https://translate.google.com/translate?hl=ja&amp;sl=en&amp;tl=ja&amp;u=https://github.com/facebook/react-native/issues/38087</p>
                    <p>未定義のローカル変数またはメソッド設定エラーを修正するには、Podfile
                    にどのような変更を追加する必要がありますか?</p>
                    <h2 id="解決策">解決策</h2>
                    <p>この問題に対して 2
                    つの解決策が見つかりました。</p>
                    <pre><code># Resolve react_native_pods.rb with node to allow for hoisting
require Pod::Executable.execute_command(&#39;node&#39;, [&#39;-p&#39;,
  &#39;require.resolve(
    &quot;react-native/scripts/react_native_pods.rb&quot;,
    {paths: [process.argv[1]]},
  )&#39;, __dir__]).strip

platform :ios, min_ios_version_supported
prepare_react_native_project!

# If you are using a `react-native-flipper` your iOS build will fail when `NO_FLIPPER=1` is set.
# because `react-native-flipper` depends on (FlipperKit,...) that will be excluded
#
# To fix this you can also exclude `react-native-flipper` using a `react-native.config.js`
# ```js
# module.exports = {
#   dependencies: {
#     ...(process.env.NO_FLIPPER ? { &#39;react-native-flipper&#39;: { platforms: { ios: null } } } : {}),
# ```
flipper_config = ENV[&#39;NO_FLIPPER&#39;] == &quot;1&quot; ? FlipperConfiguration.disabled : FlipperConfiguration.enabled

linkage = ENV[&#39;USE_FRAMEWORKS&#39;]
if linkage != nil
  Pod::UI.puts &quot;Configuring Pod with #{linkage}ally linked Frameworks&quot;.green
  use_frameworks! :linkage =&gt; linkage.to_sym
end

target &#39;HelloWorld&#39; do
  config = use_native_modules!

  # Flags change depending on the env values.
  flags = get_default_flags()

  use_react_native!(
    :path =&gt; config[:reactNativePath],
    # Hermes is now enabled by default. Disable by setting this flag to false.
    :hermes_enabled =&gt; flags[:hermes_enabled],
    :fabric_enabled =&gt; flags[:fabric_enabled],
    # Enables Flipper.
    #
    # Note that if you have use_frameworks! enabled, Flipper will not work and
    # you should disable the next line.
    :flipper_configuration =&gt; flipper_config,
    # An absolute path to your application root.
    :app_path =&gt; &quot;#{Pod::Config.instance.installation_root}/..&quot;
  )

  target &#39;HelloWorldTests&#39; do
    inherit! :complete
    # Pods for testing
  end

  post_install do |installer|
    # https://github.com/facebook/react-native/blob/main/packages/react-native/scripts/react_native_pods.rb#L197-L202
    react_native_post_install(
      installer,
      config[:reactNativePath],
      :mac_catalyst_enabled =&gt; false
    )
    __apply_Xcode_12_5_M1_post_install_workaround(installer)
  end
end
</code></pre>
                    <p>出典:</p>
                    <p>https://translate.google.com/translate?hl=ja&amp;sl=en&amp;tl=ja&amp;u=https://github.com/facebook/react-native/blob/0.72-stable/packages/react-native/template/ios/Podfile</p>
                    <p>https://translate.google.com/translate?hl=ja&amp;sl=en&amp;tl=ja&amp;u=https://github.com/facebook/react-native/issues/38067#issuecomment-1766411375</p>
        </article>
    </div>
  </main>
  <footer>
    <div class="container">
        <p>&copy; 2024 Techioz. All rights reserved.</p>
    </div>
  </footer>
</body>
</html>