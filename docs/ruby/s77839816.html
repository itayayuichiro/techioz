<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <link rel="icon" href="../favicon.ico" />
  <link rel="stylesheet" href="../style.css">
  <title>tiktoken_ruby のインストール時に Heroku で「libclang が見つかりません」というメッセージが表示される | Techioz</title>
  <style type="text/css">code{white-space: pre;}</style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1637770322917058"
     crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DRM1ZRNLDN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-DRM1ZRNLDN');
  </script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "headline": "tiktoken_ruby のインストール時に Heroku で「libclang が見つかりません」というメッセージが表示される",
  "author": {
    "@type": "Person",
    "address": "",
    "email": null,
    "identifier": "masyumaroking",
    "name": "masyumaroking"
  },
  "publisher": {
    "@type": "Person",
    "name": "masyumaroking"
  }
}
</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
  <header>
    <div class="container">
        <h1>Techioz Blog</h1>
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Articles</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </nav>
    </div>
  </header>
  <main>
    <div class="container">
        <article>
                      <h2>tiktoken_ruby のインストール時に Heroku
で「libclang が見つかりません」というメッセージが表示される</h2>
                    <h2 id="概要">概要</h2>
                    <p>Ruby 3.3.0 と tiktoken_ruby gem を備えたアプリを
                    heroku-22
                    にデプロイしようとすると、次のエラーが発生します。</p>
                    <pre><code>remote: -----&gt; Building on the Heroku-22 stack
remote: -----&gt; Using buildpack: heroku/ruby
remote: -----&gt; Ruby app detected
remote: -----&gt; Installing bundler 2.3.25
remote: -----&gt; Removing BUNDLED WITH version in the Gemfile.lock
remote: -----&gt; Compiling Ruby/Rails
remote: -----&gt; Using Ruby version: ruby-3.3.0
remote:        Ruby version change detected. Clearing bundler cache.
remote:        Old: ruby 3.1.0p0 (2021-12-25 revision fb4df44d16) [x86_64-linux]
remote:        New: ruby 3.3.0 (2023-12-25 revision 5124f9ac75) [x86_64-linux]
remote: -----&gt; Installing dependencies using bundler 2.3.25
remote:        Running: BUNDLE_WITHOUT=&#39;development:test&#39; BUNDLE_PATH=vendor/bundle BUNDLE_BIN=vendor/bundle/bin BUNDLE_DEPLOYMENT=1 bundle install -j4
remote:        Fetching gem metadata from https://rubygems.org/.........
...
remote:        Gem::Ext::BuildError: ERROR: Failed to build gem native extension.
remote:        
remote:        current directory:
remote:        /tmp/build_529a3ba8/vendor/bundle/ruby/3.3.0/bundler/gems/tiktoken_ruby-cd53cc74f6a4/ext/tiktoken_ruby
remote:        /tmp/build_529a3ba8/vendor/ruby-3.3.0/bin/ruby extconf.rb
remote:        checking for gcc... yes
remote:        checking for g++... yes
remote:        checking for gcc-ar... yes
remote:        checking for cargo... no
remote:        
remote:        current directory:
remote:        /tmp/build_529a3ba8/vendor/bundle/ruby/3.3.0/bundler/gems/tiktoken_ruby-cd53cc74f6a4/ext/tiktoken_ruby
remote:        make DESTDIR\= sitearchdir\=./.gem.20240118-209-dqfxjm
remote:        sitelibdir\=./.gem.20240118-209-dqfxjm clean
remote:        
remote:        current directory:
remote:        /tmp/build_529a3ba8/vendor/bundle/ruby/3.3.0/bundler/gems/tiktoken_ruby-cd53cc74f6a4/ext/tiktoken_ruby
remote:        make DESTDIR\= sitearchdir\=./.gem.20240118-209-dqfxjm
remote:        sitelibdir\=./.gem.20240118-209-dqfxjm
remote:        info: downloading installer
remote:        info: profile set to &#39;minimal&#39;
remote:        info: default host triple is x86_64-unknown-linux-gnu
remote:        info: skipping toolchain installation
remote:        
remote:        
remote:        Rust is installed now. Great!
remote:        
remote:        To get started you need Cargo&#39;s bin directory 
remote:        (/tmp/build_529a3ba8/vendor/bundle/ruby/3.3.0/bundler/gems/tiktoken_ruby-cd53cc74f6a4/ext/tiktoken_ruby/.rb-sys/stable/cargo/bin)
remote:        in your PATH
remote:        environment variable. This has not been done automatically.
remote:        
remote:        To configure your current shell, run:
remote:        source 
remote:        &quot;/tmp/build_529a3ba8/vendor/bundle/ruby/3.3.0/bundler/gems/tiktoken_ruby-cd53cc74f6a4/ext/tiktoken_ruby/.rb-sys/stable/cargo/env&quot;
remote:        info: syncing channel updates for &#39;stable-x86_64-unknown-linux-gnu&#39;
remote:        info: latest update on 2023-12-28, rust version 1.75.0 (82e1608df 2023-12-21)
remote:        info: downloading component &#39;cargo&#39;
remote:        info: downloading component &#39;rust-std&#39;
remote:        info: downloading component &#39;rustc&#39;
remote:        info: installing component &#39;cargo&#39;
remote:        info: installing component &#39;rust-std&#39;
remote:        info: installing component &#39;rustc&#39;
remote:        
remote:        stable-x86_64-unknown-linux-gnu installed - rustc 1.75.0 (82e1608df
remote:        2023-12-21)
remote:        
remote:        info: default toolchain set to &#39;stable-x86_64-unknown-linux-gnu&#39;
remote:        info: checking for self-update
remote:        info: using existing install for &#39;stable-x86_64-unknown-linux-gnu&#39;
remote:        info: default toolchain set to &#39;stable-x86_64-unknown-linux-gnu&#39;
remote:        
remote:        stable-x86_64-unknown-linux-gnu unchanged - rustc 1.75.0 (82e1608df
remote:        2023-12-21)
remote:        
remote:        info: note that the toolchain &#39;stable-x86_64-unknown-linux-gnu&#39; is currently i
remote:        use (environment override by RUSTUP_TOOLCHAIN)
remote:        generating target/release/libtiktoken_ruby.so (release)
remote:        /tmp/build_529a3ba8/vendor/bundle/ruby/3.3.0/bundler/gems/tiktoken_ruby-cd53cc74f6a4/ext/tiktoken_ruby/.rb-sys/stable/cargo/bin/cargo
remote:        rustc  --manifest-path ./Cargo.toml --target-dir target --lib --profile releas
remote:        -- -C linker=gcc -L native=/tmp/build_529a3ba8/vendor/ruby-3.3.0/lib -C
remote:        link-arg=-lm -l pthread
remote:            Updating crates.io index
remote:            Updating git repository `https://github.com/IAPark/tiktoken-rs.git`
remote:            Updating git submodule `https://github.com/zurawiki/tiktoken`
remote:         Downloading crates ...
remote:          Downloaded glob v0.3.1
remote:          Downloaded nom v7.1.3
remote:          Downloaded rb-sys-build v0.9.81
remote:          Downloaded parking_lot_core v0.9.7
remote:          Downloaded regex v1.7.1
remote:          Downloaded bindgen v0.66.1
remote:          Downloaded bstr v1.4.0
remote:          Downloaded libc v0.2.140
remote:          Downloaded syn v2.0.31
remote:          Downloaded regex-syntax v0.6.28
remote:          Downloaded minimal-lexical v0.2.1
remote:          Downloaded magnus v0.6.1
remote:          Downloaded serde v1.0.157
remote:          Downloaded anyhow v1.0.70
remote:          Downloaded regex-automata v0.1.10
remote:          Downloaded cfg-if v1.0.0
remote:          Downloaded proc-macro2 v1.0.66
remote:          Downloaded fancy-regex v0.11.0
remote:          Downloaded lazycell v1.3.0
remote:          Downloaded clang-sys v1.6.0
remote:          Downloaded aho-corasick v0.7.20
remote:          Downloaded unicode-ident v1.0.8
remote:          Downloaded smallvec v1.10.0
remote:          Downloaded seq-macro v0.3.5
remote:          Downloaded rb-sys v0.9.81
remote:          Downloaded parking_lot v0.12.1
remote:          Downloaded memchr v2.5.0
remote:          Downloaded base64 v0.21.0
remote:          Downloaded bit-vec v0.6.3
remote:          Downloaded lock_api v0.4.9
remote:          Downloaded libloading v0.7.4
remote:          Downloaded autocfg v1.1.0
remote:          Downloaded bitflags v2.4.0
remote:          Downloaded peeking_take_while v0.1.2
remote:          Downloaded shlex v1.1.0
remote:          Downloaded shell-words v1.1.0
remote:          Downloaded scopeguard v1.1.0
remote:          Downloaded rustc-hash v1.1.0
remote:          Downloaded rb-sys-env v0.1.2
remote:          Downloaded quote v1.0.33
remote:          Downloaded once_cell v1.17.1
remote:          Downloaded magnus-macros v0.6.0
remote:          Downloaded lazy_static v1.4.0
remote:          Downloaded cexpr v0.6.0
remote:          Downloaded bit-set v0.5.3
remote:           Compiling memchr v2.5.0
remote:           Compiling proc-macro2 v1.0.66
remote:           Compiling unicode-ident v1.0.8
remote:           Compiling glob v0.3.1
remote:           Compiling clang-sys v1.6.0
remote:           Compiling libc v0.2.140
remote:           Compiling quote v1.0.33
remote:           Compiling minimal-lexical v0.2.1
remote:           Compiling cfg-if v1.0.0
remote:           Compiling nom v7.1.3
remote:           Compiling libloading v0.7.4
remote:           Compiling syn v2.0.31
remote:           Compiling aho-corasick v0.7.20
remote:           Compiling bindgen v0.66.1
remote:           Compiling regex-syntax v0.6.28
remote:           Compiling regex v1.7.1
remote:           Compiling cexpr v0.6.0
remote:           Compiling peeking_take_while v0.1.2
remote:           Compiling lazycell v1.3.0
remote:           Compiling shlex v1.1.0
remote:           Compiling bitflags v2.4.0
remote:           Compiling rustc-hash v1.1.0
remote:           Compiling lazy_static v1.4.0
remote:           Compiling shell-words v1.1.0
remote:           Compiling autocfg v1.1.0
remote:           Compiling lock_api v0.4.9
remote:           Compiling rb-sys-build v0.9.81
remote:           Compiling parking_lot_core v0.9.7
remote:           Compiling rb-sys v0.9.81
remote:           Compiling bit-vec v0.6.3
remote:        error: failed to run custom build command for `rb-sys v0.9.81`
remote:        
remote:        Caused by:
remote:        process didn&#39;t exit successfully:
remote:        `/tmp/build_529a3ba8/vendor/bundle/ruby/3.3.0/bundler/gems/tiktoken_ruby-cd53cc74f6a4/ext/tiktoken_ruby/target/release/build/rb-sys-0b34e8f38d6837b7/build-script-main`
remote:        (exit status: 101)
remote:          --- stdout
remote:          cargo:rerun-if-env-changed=RUBY
remote:          cargo:rerun-if-env-changed=RBCONFIG_CROSS_COMPILING
remote:          cargo:rerun-if-env-changed=RBCONFIG_RUBY_PROGRAM_VERSION
remote:          cargo:rerun-if-env-changed=RBCONFIG_platform
remote:          cargo:rerun-if-env-changed=RUBY_ROOT
remote:          cargo:rerun-if-env-changed=RUBY_VERSION
remote:          cargo:rerun-if-env-changed=RUBY
remote:          cargo:rerun-if-changed=build/main.rs
remote:          cargo:rerun-if-changed=build/stable_api_config.rs
remote:          cargo:rerun-if-changed=build/version.rs
remote:          cargo:rerun-if-changed=build/features.rs
remote:          cargo:rerun-if-env-changed=RUBY_STATIC
remote:          cargo:rerun-if-env-changed=RBCONFIG_ENABLE_SHARED
remote:          cargo:rerun-if-env-changed=RBCONFIG_rubyhdrdir
remote:          cargo:rerun-if-env-changed=RBCONFIG_rubyarchhdrdir
remote:          cargo:rerun-if-env-changed=RBCONFIG_CPPFLAGS
remote:          cargo:rerun-if-env-changed=RBCONFIG_rubyhdrdir
remote:          cargo:rerun-if-env-changed=TARGET
remote:          cargo:rerun-if-env-changed=TARGET
remote:          cargo:rerun-if-env-changed=BINDGEN_EXTRA_CLANG_ARGS_x86_64-unknown-linux-gnu
remote:          cargo:rerun-if-env-changed=BINDGEN_EXTRA_CLANG_ARGS_x86_64-unknown-linux-gnu
remote:          cargo:rerun-if-env-changed=BINDGEN_EXTRA_CLANG_ARGS_x86_64_unknown_linux_gnu
remote:          cargo:rerun-if-env-changed=BINDGEN_EXTRA_CLANG_ARGS_x86_64_unknown_linux_gnu
remote:          cargo:rerun-if-env-changed=BINDGEN_EXTRA_CLANG_ARGS
remote:          cargo:rerun-if-env-changed=BINDGEN_EXTRA_CLANG_ARGS
remote:        
remote:          --- stderr
remote:        INFO: using bindgen with clang args:
remote:        [&quot;-I/tmp/build_529a3ba8/vendor/ruby-3.3.0/include/ruby-3.3.0&quot;,
remote:        &quot;-I/tmp/build_529a3ba8/vendor/ruby-3.3.0/include/ruby-3.3.0/x86_64-linux&quot;,
remote:        &quot;-fms-extensions&quot;, &quot;-O3&quot;, &quot;-fno-fast-math&quot;, &quot;-g&quot;, &quot;-Wall&quot;, &quot;-Wextra&quot;,
remote:        &quot;-Wdeprecated-declarations&quot;, &quot;-Wdiv-by-zero&quot;, &quot;-Wduplicated-cond&quot;,
remote:        &quot;-Wimplicit-function-declaration&quot;, &quot;-Wimplicit-int&quot;, &quot;-Wpointer-arith&quot;,
remote:        &quot;-Wwrite-strings&quot;, &quot;-Wold-style-definition&quot;, &quot;-Wimplicit-fallthrough=0&quot;,
remote:        &quot;-Wmissing-noreturn&quot;, &quot;-Wno-cast-function-type&quot;,
remote:        &quot;-Wno-constant-logical-operand&quot;, &quot;-Wno-long-long&quot;,
remote:        &quot;-Wno-missing-field-initializers&quot;, &quot;-Wno-overlength-strings&quot;,
remote:        &quot;-Wno-packed-bitfield-compat&quot;, &quot;-Wno-parentheses-equality&quot;, &quot;-Wno-self-assign&quot;
remote:        &quot;-Wno-tautological-compare&quot;, &quot;-Wno-unused-parameter&quot;, &quot;-Wno-unused-value&quot;,
remote:        &quot;-Wsuggest-attribute=format&quot;, &quot;-Wsuggest-attribute=noreturn&quot;,
remote:        &quot;-Wunused-variable&quot;, &quot;-Wmisleading-indentation&quot;, &quot;-Wundef&quot;]
remote:        thread &#39;main&#39; panicked at
remote:        /tmp/build_529a3ba8/vendor/bundle/ruby/3.3.0/bundler/gems/tiktoken_ruby-cd53cc74f6a4/ext/tiktoken_ruby/.rb-sys/stable/cargo/registry/src/index.crates.io-6f17d22bba15001f/bindgen-0.66.1/lib.rs:604:31:
remote:        Unable to find libclang: &quot;couldn&#39;t find any valid shared libraries matching:
remote:        [&#39;libclang.so&#39;, &#39;libclang-*.so&#39;, &#39;libclang.so.*&#39;, &#39;libclang-*.so.*&#39;], set the
remote:        `LIBCLANG_PATH` environment variable to a path where one of these files can be
remote:        found (invalid: [])&quot;
remote:          note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
                    <h2 id="解決策">解決策</h2>
                    <p>Clang をインストールする必要がありました。</p>
                    <pre><code>heroku buildpacks:add --index 1 heroku-community/apt
</code></pre>
                    <p>次に、リポジトリのルートにある Aptfile
                    で次のようにします。</p>
                    <pre><code>clang
</code></pre>
        </article>
    </div>
  </main>
  <footer>
    <div class="container">
        <p>&copy; 2024 Techioz. All rights reserved.</p>
    </div>
  </footer>
</body>
</html>