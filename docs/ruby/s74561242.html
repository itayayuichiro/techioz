<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <link rel="icon" href="../favicon.ico" />
  <link rel="stylesheet" href="../style.css">
  <title>gem install ffi が成功しても、ff1 gem が原因でバンドルのインストールが失敗する | Techioz</title>
  <style type="text/css">code{white-space: pre;}</style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1637770322917058"
     crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DRM1ZRNLDN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-DRM1ZRNLDN');
  </script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "headline": "gem install ffi が成功しても、ff1 gem が原因でバンドルのインストールが失敗する",
  "author": {
    "@type": "Person",
    "address": "",
    "email": null,
    "identifier": "masyumaroking",
    "name": "masyumaroking"
  },
  "publisher": {
    "@type": "Person",
    "name": "masyumaroking"
  }
}
</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
  <header>
    <div class="container">
        <h1>Techioz Blog</h1>
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Articles</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </nav>
    </div>
  </header>
  <main>
    <div class="container">
        <article>
                      <h2>gem install ffi が成功しても、ff1 gem
が原因でバンドルのインストールが失敗する</h2>
                    <h2 id="概要">概要</h2>
                    <p>私が行った手順</p>
                    <p>出力：</p>
                    <pre><code>Fetching gem metadata from https://rubygems.org/.........
Using public_suffix 4.0.6
Using addressable 2.8.0
Using aws-sigv4 1.0.0
Using jmespath 1.3.1
Using aws-sdk-core 2.7.15
Using aws-sdk-resources 2.7.15
Using aws-sdk 2.7.15
Using bundler 1.17.2
Using colorator 1.1.0
Using colored 1.2
Using deep_merge 1.0.1
Using configure-s3-website 2.0.0
Using dotenv 1.0.2
Fetching ffi 1.15.4
Installing ffi 1.15.4 with native extensions
Errno::EPERM: Operation not permitted @ apply2files - /Users/sucm/Development/Projects/dots-ruby3/dots.co/vendor/bundle/ruby/2.6.0/gems/ffi-1.15.4/CHANGELOG.md
An error occurred while installing ffi (1.15.4), and Bundler cannot continue.
Make sure that `gem install ffi -v &#39;1.15.4&#39; --source &#39;https://rubygems.org/&#39;` succeeds before bundling.

In Gemfile:
  jekyll was resolved to 3.6.3, which depends on
    jekyll-sass-converter was resolved to 1.5.2, which depends on
      sass was resolved to 3.7.4, which depends on
        sass-listen was resolved to 4.0.0, which depends on
          rb-inotify was resolved to 0.10.1, which depends on
            ffi
</code></pre>
                    <p>実行したその他のコマンド。それでもバンドルのインストール手順に合格できません</p>
                    <p>コマンドバンドル env の出力</p>
                    <pre><code>sucm@11575A-SUCM dots.co % bundle env
/Users/sucm/.zshrc:8: no such file or directory: /Users/sucm/.rbenv/bin/rbenv
zsh:1: command not found: chruby

Saving session...
...saving history...truncating history files...
...completed.
## Environment

</code></pre>
                    <p>バンドラー 1.17.2 プラットフォーム
                    Ruby、universal-darwin-21 Ruby 2.6.8p205 (2021-07-07
                    リビジョン 67951) [universal.arm64e-darwin21]
                    フルパス
                    /System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/bin/ruby
                    構成ディレクトリ /ライブラリ/Ruby/サイト RubyGems
                    3.0.3.1 ジェム ホーム
                    /ライブラリ/ルビー/ジェム/2.6.0 Gem パス
                    /Users/sucm/.gem/ruby/2.6.0:/Library/Ruby/Gems/2.6.0:/System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/lib/ruby/gems/
                    2.6.0 ユーザーパス /Users/sucm/.gem/ruby/2.6.0
                    ビンディレクトリ /usr/local/bin ツール Git 2.37.1
                    (Apple Git-137.1) RVM がインストールされていません
                    rbenv rbenv 1.2.0 chruby セッションが復元されました:
                    木 11 月 24 日 16:28:32 IST 2022</p>
                    <pre><code>
## Bundler Build Metadata

</code></pre>
                    <p>2018 年 12 月 19 日に構築されました Git SHA
                    3fc4de72b リリースされたバージョン false</p>
                    <pre><code>
## Bundler settings

</code></pre>
                    <p>build.ffi ローカル アプリ
                    (/Users/sucm/Development/Projects/dots-ruby3/dots.co/.bundle/config)
                    に設定:
                    “–with-cflags=-Wno-error=implicit-function-declaration”
                    現在のユーザー (/Users/sucm/.bundle/config) に設定:
                    “–with-cflags=-Wno-error=implicit-function-declaration”
                    パス ローカル アプリ
                    (/Users/sucm/Development/Projects/dots-ruby3/dots.co/.bundle/config)
                    に設定: “vendor/bundle”</p>
                    <pre><code>
## Gemfile

### Gemfile

```ruby
# frozen_string_literal: true
source &#39;https://rubygems.org&#39;

gem &#39;jekyll&#39;
gem &#39;s3_website&#39;
</code></pre>
                    <pre><code>GEM
  remote: https://rubygems.org/
  specs:
    addressable (2.8.0)
      public_suffix (&gt;= 2.0.2, &lt; 5.0)
    aws-sdk (2.7.15)
      aws-sdk-resources (= 2.7.15)
    aws-sdk-core (2.7.15)
      aws-sigv4 (~&gt; 1.0)
      jmespath (~&gt; 1.0)
    aws-sdk-resources (2.7.15)
      aws-sdk-core (= 2.7.15)
    aws-sigv4 (1.0.0)
    colorator (1.1.0)
    colored (1.2)
    configure-s3-website (2.0.0)
      aws-sdk (~&gt; 2)
      deep_merge (~&gt; 1.0.0)
    deep_merge (1.0.1)
    dotenv (1.0.2)
    ffi (1.15.4)
    forwardable-extended (2.6.0)
    jekyll (3.6.3)
      addressable (~&gt; 2.4)
      colorator (~&gt; 1.0)
      jekyll-sass-converter (~&gt; 1.0)
      jekyll-watch (~&gt; 1.1)
      kramdown (~&gt; 1.14)
      liquid (~&gt; 4.0)
      mercenary (~&gt; 0.3.3)
      pathutil (~&gt; 0.9)
      rouge (&gt;= 1.7, &lt; 3)
      safe_yaml (~&gt; 1.0)
    jekyll-sass-converter (1.5.2)
      sass (~&gt; 3.4)
    jekyll-watch (1.5.1)
      listen (~&gt; 3.0)
    jmespath (1.3.1)
    kramdown (1.17.0)
    liquid (4.0.3)
    listen (3.7.0)
      rb-fsevent (~&gt; 0.10, &gt;= 0.10.3)
      rb-inotify (~&gt; 0.9, &gt;= 0.9.10)
    mercenary (0.3.6)
    pathutil (0.16.2)
      forwardable-extended (~&gt; 2.6)
    public_suffix (4.0.6)
    rb-fsevent (0.11.0)
    rb-inotify (0.10.1)
      ffi (~&gt; 1.0)
    rouge (2.2.1)
    s3_website (3.0.0)
      colored (= 1.2)
      configure-s3-website (= 2.0.0)
      dotenv (~&gt; 1.0)
      thor (~&gt; 0.18)
    safe_yaml (1.0.5)
    sass (3.7.4)
      sass-listen (~&gt; 4.0.0)
    sass-listen (4.0.0)
      rb-fsevent (~&gt; 0.9, &gt;= 0.9.4)
      rb-inotify (~&gt; 0.9, &gt;= 0.9.7)
    thor (0.19.4)

PLATFORMS
  ruby

DEPENDENCIES
  jekyll
  s3_website

BUNDLED WITH
   1.14.5
</code></pre>
                    <h2 id="解決策">解決策</h2>
                    <p>私はこの問題に遭遇し、最終的に組み込みの libffi
                    バージョンの使用を強制することで修正を見つけました。</p>
                    <pre><code>gem install ffi -- --disable-system-libffi
bundle config build.ffi --disable-system-libffi
</code></pre>
                    <p>参考: ffi/ffi: Ruby FFI:</p>
        </article>
    </div>
  </main>
  <footer>
    <div class="container">
        <p>&copy; 2024 Techioz. All rights reserved.</p>
    </div>
  </footer>
</body>
</html>